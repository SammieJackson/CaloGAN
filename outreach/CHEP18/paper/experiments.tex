\section{Experiments}

We start with quantitative evaluation of the proposed simulation method. While generic evaluation methods for generative models exist, here we base our evaluation on physics-driven similarity metrics. These metrics are designed using the domain knowledge and the recommendations from physicists on the evaluation of simulation procedures. Hence, we use the following metrics: \todo{describe metrics}. 


As a part of the analyzing generated images quality we calculated some physical characteristics of shower shapes such as cluster asymmetry, shower width and sparsity level. The obtained characteristics are presented in~\cref{fig:quality}. How to calculate these variables is described in Appendix.


We first use the data described in~\ref{sec:data} . Our results are great compared to geant. Now we run CaloGAN on the same data, the comparison is in the table   

\begin{figure}
  \centering
  \centering
  \begin{subfigure}{0.19\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/transverseAsymmetry.pdf}
    \caption{The transverse asymmetry of real and generated images}
  \end{subfigure}
  \begin{subfigure}{0.19\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/longAsymmetry.pdf}
    \caption{The longitudal asymmetry of real and generated images}
  \end{subfigure}
  \begin{subfigure}{0.19\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/width.pdf}
    \caption{The transverse width of real and generated images}
  \end{subfigure}
  \begin{subfigure}{0.19\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/deltaX.pdf}
    \caption{Delta X}
  \end{subfigure}
  \begin{subfigure}{0.19\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/sparsity.pdf}
    \caption{The sparsity of real and generated images}
  \end{subfigure}
  \caption{Generated images quality evaluation including described physical characteristics.}\label{fig:quality}  
\end{figure}

The results are in good agreement with fully simulated data. Energy showers are faithfully reproduced and show a reasonable agreement with the standard Monte Carlo techniques. A detailed study to asses the quality of the GAN images using typical high level calorimeter reconstruction variables confirms this statement.




We additionally compare the proposed model and CaloGAN on the CaloGAN dataset (table 2). Our model works better on that data, which shows that we did it well.


% From a series of simulated electron showers our conditional GAN is tasked with learning the simulated data distributions generated by \geant. There exist several methods to estimate the performance of generative models, but not all evaluation criteria are equally suitable and reliable for all applications. In our paper we focus on quantitative evaluation based on physics-driven similarity metrics. The choice reflects the domain specific procedure for data-simulation comparison. 

We qualitatively compare the showers obtained with Monte Carlo simulator implemented in \geant and our model~\cref{fig:geant_vs_ours}. \todo{say something about it? is it obviously beter or worse for some specific sets of parameters?} 


% Examples of real and produced images are presented in~\cref{fig:gen-imgs-2}. It can be concluded that produced images look quite similar to the original data but we are also supposed to do more deep analysis.

\begin{figure}
\captionsetup[subfigure]{justification=centering}
  \centering
  \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/1_real.png}
    % \caption{\\$E = 63.7~\text{GeV}$ \\ $\frac{p_x}{p_z}=0.005$ \\ $\frac{p_y}{p_z}=0.154$}\label{fig:real-imgs-1}
  \end{subfigure}
  \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/2_real.png}
    % \caption{\\$E = 6.5~\text{GeV}$ \\  $\frac{p_x}{p_z}=0.0046$ \\$\frac{p_y}{p_z}=0.108$}\label{fig:real-imgs-2}
  \end{subfigure}
    \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/3_real.png}
    % \caption{\\$E = 15.6~\text{GeV}$ \\ $\frac{p_x}{p_z}=0.196$ \\ $\frac{p_y}{p_z}=-0.036$}\label{fig:real-imgs-3}
  \end{subfigure}
  \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/4_real.png}
    % \caption{\\$E = 15.6~\text{GeV}$ \\  $\frac{p_x}{p_z}=-0.019$ \\ $\frac{p_y}{p_z}=0.181$}\label{fig:real-imgs-4}
  \end{subfigure}\\
   \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/1_gen.png}
    \caption{\\$E = 63.7~\text{GeV}$ \\ $\frac{p_x}{p_z}=0.005$ \\ $\frac{p_y}{p_z}=0.154$}%\label{fig:gen-imgs-1}
  \end{subfigure}
  \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/2_gen.png}
    \caption{\\$E = 6.5~\text{GeV}$ \\  $\frac{p_x}{p_z}=0.0046$ \\$\frac{p_y}{p_z}=0.108$}%\label{fig:gen-imgs-2}
  \end{subfigure}
    \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/3_gen.png}
    \caption{\\$E = 15.6~\text{GeV}$ \\ $\frac{p_x}{p_z}=0.196$ \\ $\frac{p_y}{p_z}=-0.036$}%\label{fig:gen-imgs-3}
  \end{subfigure}
  \begin{subfigure}{0.24\textwidth}
    \centering
    \includegraphics[width=1\textwidth]{figures/4_gen.png}
    \caption{\\$E = 15.6~\text{GeV}$ \\  $\frac{p_x}{p_z}=-0.019$ \\ $\frac{p_y}{p_z}=0.181$}%\label{fig:gen-imgs-4}
  \end{subfigure}
 
  \caption{Showers generated with \geant (first row) and the showers, simulated with our model (second row) for three different sets of input parameters. \todo{generate high quality images,  Have one (and fixed to be the same for each plot) color bar on the left or on the right. }}
  \label{fig:geant_vs_ours}
\end{figure}



As for model performance, we trained our model for 3000 epochs which takes about 70 hours on GPU NVIDIA Tesla K80. The sampling rate is 0.07 ms per sample on GPU, 4.9 ms per sample on CPU.
